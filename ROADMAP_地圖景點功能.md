# 地圖與景點功能開發路線圖

**創建日期:** 2025-12-17  
**目標:** 循序漸進地實現地圖標記、景點管理和路線規劃功能

---

## 📋 開發階段規劃

### 階段 1: 景點列表功能 (基礎) ✅ 進行中
**預計時間:** 1-2 小時  
**優先級:** 🔴 高

#### 1.1 實現景點列表頁面 ✅ 已完成
- [x] 顯示當前計畫的所有景點
- [x] 景點卡片設計（名稱、地址、類型）
- [x] 空狀態提示
- [x] 添加景點按鈕

#### 1.2 景點篩選和排序 ✅ 已完成
- [x] 按天數篩選
- [x] 按類型篩選（寺廟、餐廳、購物等）
- [x] 排序選項（時間、名稱、天數）

#### 1.3 景點操作 ✅ 已完成
- [x] 點擊查看詳情
- [x] 滑動刪除
- [x] 編輯景點

**完成標準:**
- ✅ 能顯示所有景點列表
- ✅ 能按天數和類型篩選
- ✅ 能進行基本的增刪改操作

---

### 階段 2: 基礎地圖顯示 🗺️
**預計時間:** 2-3 小時  
**優先級:** 🔴 高

#### 2.1 設置 Google Maps
- [ ] 確認 Google Maps API Key 已配置
- [ ] 安裝 react-native-maps (已安裝)
- [ ] 創建基礎地圖組件

#### 2.2 地圖基本功能
- [ ] 顯示日本地圖（預設東京）
- [ ] 地圖縮放和拖動
- [ ] 定位到當前計畫的目的地

#### 2.3 景點標記
- [ ] 在地圖上顯示所有景點標記
- [ ] 不同類型使用不同顏色標記
- [ ] 點擊標記顯示景點資訊

**完成標準:**
- ✅ 地圖正常顯示
- ✅ 所有景點都有標記
- ✅ 能點擊標記查看資訊

---

### 階段 3: 地圖與列表聯動 🔗
**預計時間:** 1-2 小時  
**優先級:** 🟡 中

#### 3.1 雙向聯動
- [ ] 點擊列表中的景點，地圖自動定位
- [ ] 點擊地圖標記，列表滾動到對應項
- [ ] 高亮顯示選中的景點

#### 3.2 視圖切換
- [ ] 地圖視圖 / 列表視圖切換
- [ ] 混合視圖（地圖 + 底部列表）
- [ ] 記住用戶偏好

**完成標準:**
- ✅ 地圖和列表能互相聯動
- ✅ 視圖切換流暢
- ✅ 用戶體驗良好

---

### 階段 4: 路線規劃 🛣️
**預計時間:** 3-4 小時  
**優先級:** 🟡 中

#### 4.1 基礎路線
- [ ] 使用 Google Directions API
- [ ] 顯示景點之間的路線
- [ ] 計算距離和時間

#### 4.2 每日路線
- [ ] 按天數分組顯示路線
- [ ] 優化路線順序（最短路徑）
- [ ] 顯示總距離和預計時間

#### 4.3 路線詳情
- [ ] 步行 / 開車 / 大眾運輸選項
- [ ] 顯示轉乘資訊
- [ ] 導出路線到 Google Maps

**完成標準:**
- ✅ 能顯示景點間的路線
- ✅ 能計算距離和時間
- ✅ 支援多種交通方式

---

### 階段 5: 進階功能 ✨
**預計時間:** 2-3 小時  
**優先級:** 🟢 低

#### 5.1 地圖上添加景點
- [ ] 長按地圖添加景點
- [ ] 搜索地點並添加
- [ ] 從推薦景點添加

#### 5.2 景點照片
- [ ] 拍照上傳
- [ ] 從相簿選擇
- [ ] 照片預覽和刪除

#### 5.3 離線地圖
- [ ] 下載地圖區域
- [ ] 離線查看景點
- [ ] 同步標記

**完成標準:**
- ✅ 能在地圖上直接添加景點
- ✅ 能上傳和管理照片
- ✅ 支援基本離線功能

---

## 🎯 第一步：實現景點列表頁面

### 需要修改的檔案
1. `app/(tabs)/places.tsx` - 景點列表主頁面
2. `hooks/usePlaces.ts` - 已存在，可直接使用
3. `services/firestore.ts` - 檢查景點相關服務

### 設計規格

#### UI 組件
```
┌─────────────────────────┐
│   📍 景點 (12)          │ ← Header
├─────────────────────────┤
│ [全部] [第1天] [第2天]  │ ← 篩選標籤
├─────────────────────────┤
│ ┌───────────────────┐   │
│ │ 🏯 淺草寺          │   │
│ │ 東京都台東區...    │   │ ← 景點卡片
│ │ 第1天 • 寺廟       │   │
│ └───────────────────┘   │
│ ┌───────────────────┐   │
│ │ 🍜 一蘭拉麵        │   │
│ │ 新宿區...          │   │
│ │ 第1天 • 餐廳       │   │
│ └───────────────────┘   │
├─────────────────────────┤
│      [➕ 新增景點]      │ ← 底部按鈕
└─────────────────────────┘
```

#### 功能清單
- ✅ 顯示景點列表
- ✅ 按天數篩選
- ✅ 景點卡片點擊進入詳情
- ✅ 新增景點按鈕
- ✅ 空狀態提示
- ✅ 載入狀態

---

## 📦 需要的套件

### 已安裝
- ✅ `react-native-maps` (1.20.1)
- ✅ `expo-location` (19.0.8)
- ✅ `@react-native-async-storage/async-storage`

### 可能需要安裝
- [ ] `react-native-maps-directions` (路線規劃)
- [ ] `expo-image-picker` (照片上傳)
- [ ] `@react-native-community/geolocation` (定位)

---

## 🔑 API 配置檢查

### Google Maps API
需要啟用以下 API：
- [x] Maps SDK for Android
- [x] Maps SDK for iOS  
- [ ] Directions API (路線規劃需要)
- [ ] Places API (搜索景點需要)
- [ ] Geocoding API (地址轉座標，已有)

**API Key 位置:** `.env` 檔案中的 `EXPO_PUBLIC_GOOGLE_MAPS_API_KEY`

---

## 🧪 測試計劃

### 階段 1 測試
- [ ] 顯示景點列表
- [ ] 篩選功能正常
- [ ] 新增景點流程
- [ ] 編輯景點流程
- [ ] 刪除景點流程

### 階段 2 測試
- [ ] 地圖正常載入
- [ ] 標記正確顯示
- [ ] 點擊標記顯示資訊
- [ ] 地圖縮放和拖動

### 階段 3 測試
- [ ] 列表點擊定位地圖
- [ ] 地圖點擊更新列表
- [ ] 視圖切換流暢

---

## 💡 開發建議

### 循序漸進原則
1. **先完成基礎功能** - 不要一次做太多
2. **每個階段都測試** - 確保功能正常再繼續
3. **保持代碼整潔** - 及時重構和優化
4. **記錄問題** - 遇到問題記下來

### 代碼組織
```
app/(tabs)/
  ├── places.tsx          # 景點列表頁
  └── map.tsx             # 地圖頁

components/
  ├── PlaceCard.tsx       # 景點卡片組件
  ├── PlaceFilter.tsx     # 篩選組件
  └── MapView.tsx         # 地圖組件

hooks/
  ├── usePlaces.ts        # 景點管理 (已存在)
  └── useMap.ts           # 地圖狀態管理 (新增)

services/
  ├── firestore.ts        # Firestore 操作
  └── maps.ts             # Google Maps API (已存在)
```

---

## 🚀 開始開發

### 立即開始：階段 1.1 - 景點列表頁面

**第一步:** 實現基礎的景點列表顯示
- 使用現有的 `usePlaces` hook
- 創建景點卡片組件
- 實現基本的列表 UI

**預計時間:** 30-45 分鐘

準備好了嗎？讓我們開始吧！🎉
